<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Utah HS MTB Racing Analytics - 2025 Region 5</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        // Category funnel ordering (beginner to advanced)
        const CATEGORY_ORDER = [
          'Beginner 7th Grade Boys',
          'Beginner 8th Grade Boys',
          'Beginner Girls',
          'Intermediate 7th Grade Boys',
          'Intermediate 8th Grade Boys',
          'Intermediate Girls',
          'Advanced Boys',
          'Advanced Girls',
          'SLR Boys',
          'SLR Girls',
          'Freshman C Boys',
          'Freshman B Boys',
          'Freshman A Boys',
          'JV E Boys',
          'JV D Boys',
          'JV C Boys',
          'JV B Boys',
          'JV A Boys',
          'Varsity Boys',
          'Varsity Girls'
        ];

        // Nebo Goats composite team members
        const NEBO_GOATS_TEAMS = ['Maple Mountain', 'Salem Hills', 'Payson', 'Spanish Fork', 'Springville'];

        const App = () => {
          const [raceData, setRaceData] = useState([]);
          const [loading, setLoading] = useState(true);
          const [error, setError] = useState(null);
          const [activePage, setActivePage] = useState('teams'); // 'teams' or 'individuals'
          
          // Team page state
          const [selectedRace, setSelectedRace] = useState('all');
          const [selectedTeams, setSelectedTeams] = useState([]);
          const [showNeboGoats, setShowNeboGoats] = useState(false);

          // Individual page state
          const [selectedRider, setSelectedRider] = useState('');
          const [searchTerm, setSearchTerm] = useState('');
          const [showDropdown, setShowDropdown] = useState(false);

          // Load race data
          useEffect(() => {
            fetch('race_data.json')
              .then(response => {
                if (!response.ok) throw new Error('Failed to load race data');
                return response.json();
              })
              .then(data => {
                setRaceData(data);
                setLoading(false);
                const firstRider = [...new Set(data.map(d => d.Name))].sort()[0];
                setSelectedRider(firstRider);
              })
              .catch(err => {
                setError(err.message);
                setLoading(false);
              });
          }, []);

          // Get unique teams and races
          const allTeams = raceData.length > 0 
            ? [...new Set(raceData.map(d => d.Team))].sort()
            : [];
          
          const allRaces = raceData.length > 0
            ? [...new Set(raceData.map(d => d.Race))].sort((a, b) => {
                const numA = parseInt(a.match(/\d+/));
                const numB = parseInt(b.match(/\d+/));
                return numA - numB;
              })
            : [];

          // Calculate team metrics
          const calculateTeamMetrics = (teamName, raceFilter) => {
            const teamData = raceData.filter(d => 
              d.Team === teamName && 
              (raceFilter === 'all' || d.Race === raceFilter)
            );

            if (teamData.length === 0) return null;

            // Total unique racers
            const totalRacers = new Set(teamData.map(d => d.Name)).size;

            // Podium finishes (1-5)
            const podiumCount = teamData.filter(d => {
              const placement = parseInt(d.Placement);
              return placement >= 1 && placement <= 5;
            }).length;

            // Top 25% finishers
            const categoryCounts = {};
            raceData.forEach(d => {
              if (raceFilter === 'all' || d.Race === raceFilter) {
                const key = `${d.Race}-${d["Race Category"]}`;
                categoryCounts[key] = (categoryCounts[key] || 0) + 1;
              }
            });

            const top25Count = teamData.filter(d => {
              const placement = parseInt(d.Placement);
              const key = `${d.Race}-${d["Race Category"]}`;
              const totalInCategory = categoryCounts[key] || 1;
              const threshold = Math.ceil(totalInCategory * 0.25);
              return placement <= threshold;
            }).length;

            // Average gap to winner
            const gaps = [];
            teamData.forEach(entry => {
              const placement = parseInt(entry.Placement);
              if (placement > 1 && entry.TotalSeconds) {
                // Find winner in same category/race
                const winner = raceData.find(d => 
                  d.Race === entry.Race &&
                  d["Race Category"] === entry["Race Category"] &&
                  d.Placement === "1" &&
                  d.TotalSeconds
                );
                if (winner && winner.TotalSeconds) {
                  gaps.push(entry.TotalSeconds - winner.TotalSeconds);
                }
              }
            });
            const avgGap = gaps.length > 0 
              ? gaps.reduce((a, b) => a + b, 0) / gaps.length 
              : 0;

            // Gender balance
            const maleCount = teamData.filter(d => {
              const cat = d["Race Category"];
              return cat.includes('Boys') || cat.includes('Boy');
            }).length;
            const femaleCount = teamData.filter(d => {
              const cat = d["Race Category"];
              return cat.includes('Girls') || cat.includes('Girl');
            }).length;

            // Category distribution
            const categoryDist = {};
            teamData.forEach(d => {
              const cat = d["Race Category"];
              categoryDist[cat] = (categoryDist[cat] || 0) + 1;
            });

            return {
              team: teamName,
              totalRacers,
              podiumCount,
              top25Count,
              avgGap: Math.round(avgGap),
              maleCount,
              femaleCount,
              malePercent: totalRacers > 0 ? Math.round((maleCount / teamData.length) * 100) : 0,
              femalePercent: totalRacers > 0 ? Math.round((femaleCount / teamData.length) * 100) : 0,
              categoryDist
            };
          };

          // Get teams to display
          const teamsToShow = showNeboGoats 
            ? NEBO_GOATS_TEAMS.filter(t => allTeams.includes(t))
            : selectedTeams.length > 0 
              ? selectedTeams 
              : allTeams.slice(0, 5); // Show top 5 by default

          const teamMetrics = teamsToShow
            .map(t => calculateTeamMetrics(t, selectedRace))
            .filter(m => m !== null)
            .sort((a, b) => b.totalRacers - a.totalRacers);

          // Format time helper
          const formatTime = (seconds) => {
            if (!seconds) return 'DNF';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
          };

          // Loading/Error states
          if (loading) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-green-50 p-6 flex items-center justify-center">
                <div className="bg-white rounded-lg shadow-lg p-8 text-center">
                  <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                  <p className="text-lg font-semibold text-gray-700">Loading race data...</p>
                </div>
              </div>
            );
          }

          if (error) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-50 to-green-50 p-6 flex items-center justify-center">
                <div className="bg-white rounded-lg shadow-lg p-8 text-center max-w-md">
                  <div className="text-red-600 text-5xl mb-4">‚ö†Ô∏è</div>
                  <h2 className="text-xl font-bold text-gray-900 mb-2">Failed to Load Data</h2>
                  <p className="text-gray-600 mb-4">{error}</p>
                  <p className="text-sm text-gray-500">Make sure race_data.json is in the same directory.</p>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 to-green-50 p-4 md:p-6">
              {/* Header */}
              <div className="bg-white rounded-lg shadow-lg p-4 md:p-6 mb-4">
                <h1 className="text-2xl md:text-3xl font-bold text-gray-900">
                  üöµ Utah HS MTB Racing Analytics
                </h1>
                <p className="text-gray-600 mt-1">2025 Region 5 Season ‚Ä¢ {raceData.length} entries</p>
              </div>

              {/* Tab Navigation */}
              <div className="bg-white rounded-lg shadow-lg p-2 mb-4">
                <div className="flex gap-2">
                  <button
                    onClick={() => setActivePage('teams')}
                    className={`flex-1 px-4 py-3 rounded-lg font-semibold transition-all ${
                      activePage === 'teams'
                        ? 'bg-blue-600 text-white shadow-md'
                        : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                    }`}
                  >
                    üìä Team Comparison
                  </button>
                  <button
                    onClick={() => setActivePage('individuals')}
                    className={`flex-1 px-4 py-3 rounded-lg font-semibold transition-all ${
                      activePage === 'individuals'
                        ? 'bg-blue-600 text-white shadow-md'
                        : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                    }`}
                  >
                    üë§ Individual Racers
                  </button>
                </div>
              </div>

              {/* PAGE 1: TEAM COMPARISON */}
              {activePage === 'teams' && (
                <TeamComparisonPage
                  allTeams={allTeams}
                  allRaces={allRaces}
                  selectedRace={selectedRace}
                  setSelectedRace={setSelectedRace}
                  selectedTeams={selectedTeams}
                  setSelectedTeams={setSelectedTeams}
                  showNeboGoats={showNeboGoats}
                  setShowNeboGoats={setShowNeboGoats}
                  teamMetrics={teamMetrics}
                  raceData={raceData}
                  formatTime={formatTime}
                />
              )}

              {/* PAGE 2: INDIVIDUAL RACERS */}
              {activePage === 'individuals' && (
                <IndividualRacersPage
                  raceData={raceData}
                  selectedRider={selectedRider}
                  setSelectedRider={setSelectedRider}
                  searchTerm={searchTerm}
                  setSearchTerm={setSearchTerm}
                  showDropdown={showDropdown}
                  setShowDropdown={setShowDropdown}
                  formatTime={formatTime}
                />
              )}
            </div>
          );
        };

        // TEAM COMPARISON PAGE COMPONENT
        const TeamComparisonPage = ({ 
          allTeams, allRaces, selectedRace, setSelectedRace, 
          selectedTeams, setSelectedTeams, showNeboGoats, setShowNeboGoats,
          teamMetrics, raceData, formatTime 
        }) => {
          return (
            <>
              {/* Filters */}
              <div className="bg-white rounded-lg shadow-lg p-4 md:p-6 mb-4">
                <h2 className="text-lg md:text-xl font-bold mb-4">Filters</h2>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {/* Race Filter */}
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Race</label>
                    <select
                      value={selectedRace}
                      onChange={(e) => setSelectedRace(e.target.value)}
                      className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                    >
                      <option value="all">All Races</option>
                      {allRaces.map(race => (
                        <option key={race} value={race}>{race}</option>
                      ))}
                    </select>
                  </div>

                  {/* Team Multi-Select */}
                  <div>
                    <label className="block text-sm font-semibold text-gray-700 mb-2">Teams</label>
                    <select
                      multiple
                      value={selectedTeams}
                      onChange={(e) => {
                        const values = Array.from(e.target.selectedOptions, option => option.value);
                        setSelectedTeams(values);
                        setShowNeboGoats(false);
                      }}
                      className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none h-24"
                    >
                      {allTeams.map(team => (
                        <option key={team} value={team}>{team}</option>
                      ))}
                    </select>
                    <p className="text-xs text-gray-500 mt-1">Hold Ctrl/Cmd to select multiple</p>
                  </div>
                </div>

                {/* Nebo Goats Toggle */}
                <div className="mt-4">
                  <button
                    onClick={() => {
                      setShowNeboGoats(!showNeboGoats);
                      setSelectedTeams([]);
                    }}
                    className={`px-4 py-2 rounded-lg font-semibold transition-all ${
                      showNeboGoats
                        ? 'bg-orange-500 text-white shadow-md'
                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                    }`}
                  >
                    üêê {showNeboGoats ? 'Showing' : 'Show'} Nebo Goats Teams
                  </button>
                  {showNeboGoats && (
                    <p className="text-sm text-gray-600 mt-2">
                      Maple Mountain ‚Ä¢ Salem Hills ‚Ä¢ Payson ‚Ä¢ Spanish Fork ‚Ä¢ Springville
                    </p>
                  )}
                </div>
              </div>

              {/* Core Metrics */}
              <div className="bg-white rounded-lg shadow-lg p-4 md:p-6 mb-4">
                <h2 className="text-lg md:text-xl font-bold mb-4">Core Performance Metrics</h2>
                
                <div className="overflow-x-auto">
                  <table className="w-full text-sm">
                    <thead>
                      <tr className="border-b-2 border-gray-300">
                        <th className="px-3 py-2 text-left font-bold">Team</th>
                        <th className="px-3 py-2 text-center font-bold">Total Racers</th>
                        <th className="px-3 py-2 text-center font-bold">Podium (1-5)</th>
                        <th className="px-3 py-2 text-center font-bold">Top 25%</th>
                        <th className="px-3 py-2 text-center font-bold">Avg Gap to Winner</th>
                      </tr>
                    </thead>
                    <tbody>
                      {teamMetrics.map((team, idx) => {
                        const isNeboGoat = NEBO_GOATS_TEAMS.includes(team.team);
                        return (
                          <tr key={idx} className={`border-b ${isNeboGoat ? 'bg-orange-50' : ''}`}>
                            <td className="px-3 py-3 font-semibold">
                              {team.team}
                              {isNeboGoat && <span className="ml-2">üêê</span>}
                            </td>
                            <td className="px-3 py-3 text-center text-lg font-bold text-blue-600">
                              {team.totalRacers}
                            </td>
                            <td className="px-3 py-3 text-center text-lg font-bold text-yellow-600">
                              {team.podiumCount}
                            </td>
                            <td className="px-3 py-3 text-center text-lg font-bold text-green-600">
                              {team.top25Count}
                            </td>
                            <td className="px-3 py-3 text-center font-mono text-gray-700">
                              {team.avgGap > 0 ? `+${formatTime(team.avgGap)}` : '-'}
                            </td>
                          </tr>
                        );
                      })}
                    </tbody>
                  </table>
                </div>
              </div>

              {/* Gender Balance */}
              <div className="bg-white rounded-lg shadow-lg p-4 md:p-6 mb-4">
                <h2 className="text-lg md:text-xl font-bold mb-4">Gender Balance</h2>
                
                <div className="space-y-4">
                  {teamMetrics.map((team, idx) => {
                    const isNeboGoat = NEBO_GOATS_TEAMS.includes(team.team);
                    return (
                      <div key={idx}>
                        <div className="flex justify-between items-center mb-2">
                          <span className="font-semibold text-gray-800">
                            {team.team}
                            {isNeboGoat && <span className="ml-2">üêê</span>}
                          </span>
                          <span className="text-sm text-gray-600">
                            {team.maleCount + team.femaleCount} riders
                          </span>
                        </div>
                        <div className="flex h-8 rounded-lg overflow-hidden border-2 border-gray-200">
                          <div 
                            className="bg-blue-500 flex items-center justify-center text-white text-xs font-bold"
                            style={{ width: `${team.malePercent}%` }}
                          >
                            {team.malePercent > 15 && `${team.malePercent}% Male`}
                          </div>
                          <div 
                            className="bg-pink-500 flex items-center justify-center text-white text-xs font-bold"
                            style={{ width: `${team.femalePercent}%` }}
                          >
                            {team.femalePercent > 15 && `${team.femalePercent}% Female`}
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>

              {/* Program Funnel */}
              <div className="bg-white rounded-lg shadow-lg p-4 md:p-6 mb-4">
                <h2 className="text-lg md:text-xl font-bold mb-4">Program Development Funnel</h2>
                <p className="text-sm text-gray-600 mb-4">Rider distribution across categories (beginner ‚Üí advanced)</p>
                
                <div className="space-y-3">
                  {CATEGORY_ORDER.map(category => {
                    const categoryData = teamMetrics.map(team => ({
                      team: team.team,
                      count: team.categoryDist[category] || 0,
                      isNeboGoat: NEBO_GOATS_TEAMS.includes(team.team)
                    }));
                    
                    const total = categoryData.reduce((sum, d) => sum + d.count, 0);
                    
                    if (total === 0) return null;
                    
                    return (
                      <div key={category}>
                        <div className="text-sm font-semibold text-gray-700 mb-1">{category}</div>
                        <div className="flex h-8 rounded-lg overflow-hidden border-2 border-gray-200">
                          {categoryData.map((data, idx) => {
                            if (data.count === 0) return null;
                            const percent = (data.count / total) * 100;
                            const colors = ['bg-blue-400', 'bg-green-400', 'bg-purple-400', 'bg-yellow-400', 'bg-red-400'];
                            const bgColor = data.isNeboGoat ? 'bg-orange-400' : colors[idx % colors.length];
                            
                            return (
                              <div
                                key={data.team}
                                className={`${bgColor} flex items-center justify-center text-white text-xs font-bold`}
                                style={{ width: `${percent}%` }}
                                title={`${data.team}: ${data.count} riders`}
                              >
                                {percent > 10 && `${data.count}`}
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            </>
          );
        };

        // INDIVIDUAL RACERS PAGE COMPONENT
        const IndividualRacersPage = ({
          raceData, selectedRider, setSelectedRider,
          searchTerm, setSearchTerm, showDropdown, setShowDropdown,
          formatTime
        }) => {
          // Get unique riders with their teams
          const riderWithTeam = raceData.length > 0 
            ? [...new Set(raceData.map(d => d.Name))].sort().map(name => {
                const riderData = raceData.find(d => d.Name === name);
                return {
                  name: name,
                  team: riderData?.Team || '',
                  races: raceData.filter(d => d.Name === name).length
                };
              })
            : [];

          // Filter riders based on search
          const filteredRiders = riderWithTeam.filter(rider => 
            rider.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
            rider.team.toLowerCase().includes(searchTerm.toLowerCase())
          );
          
          // Get data for selected rider
          const riderRaces = raceData
            .filter(d => d.Name === selectedRider)
            .sort((a, b) => a.RaceNum - b.RaceNum);
          const riderTeam = riderRaces[0]?.Team || '';
          
          // Calculate stats
          const totalRaces = riderRaces.length;
          const bestPlacement = riderRaces.length > 0 
            ? Math.min(...riderRaces.map(r => parseInt(r.Placement))) 
            : 0;
          const podiumCount = riderRaces.filter(r => parseInt(r.Placement) <= 5).length;

          // Helper to parse lap time strings to seconds
          const parseTimeToSeconds = (timeStr) => {
            if (!timeStr) return null;
            const parts = timeStr.split(':');
            if (parts.length === 2) {
              return parseInt(parts[0]) * 60 + parseFloat(parts[1]);
            }
            return null;
          };

          // Generate race analysis
          const generateRaceAnalysis = (race, idx, allRaces) => {
            const placement = parseInt(race.Placement);
            const isPodium = placement <= 5;
            const prevRace = idx > 0 ? allRaces[idx - 1] : null;
            const placementChange = prevRace ? parseInt(prevRace.Placement) - placement : null;
            const isFirstRace = idx === 0;
            
            const lap1Seconds = parseTimeToSeconds(race.LAP1);
            const lap2Seconds = parseTimeToSeconds(race.LAP2);
            let lapDifference = null;
            if (lap1Seconds && lap2Seconds) {
              lapDifference = lap2Seconds - lap1Seconds;
            }
            
            let analysis = '';
            let focus = '';
            
            if (isFirstRace) {
              if (isPodium) {
                analysis = `Fantastic start to the season with a top 5 finish! You're showing great potential right out of the gate.`;
                focus = `Focus on: Maintaining this momentum. Keep your training consistent and work on race-day nutrition to sustain energy.`;
              } else if (placement <= 10) {
                analysis = `Great first race of the year! Breaking into the top 10 is a solid foundation to build on.`;
                focus = `Focus on: Study the riders ahead of you. What lines are they taking? Where are they gaining time?`;
              } else {
                analysis = `First race of the year! Everyone starts somewhere, and you're building valuable experience.`;
                focus = `Focus on: Ride at a sustainable pace. Many riders go too hard early‚Äîconsistent effort beats early burnout.`;
              }
            } else {
              if (placementChange > 0) {
                analysis = `Excellent progress! You moved up ${placementChange} place${placementChange > 1 ? 's' : ''} from last race. Your hard work is paying off!`;
                focus = `Focus on: Whatever you changed is working! Keep that training approach and look for small refinements.`;
              } else if (placementChange < 0) {
                analysis = `You dropped ${Math.abs(placementChange)} place${Math.abs(placementChange) > 1 ? 's' : ''} this race, but remember‚Äîdifferent courses favor different strengths and competition varies.`;
                focus = `Focus on: Review what felt different. Was it pacing, nutrition, or just a tougher field? Adjust and come back stronger.`;
              } else {
                analysis = `Consistent performance! Maintaining your placement shows you're holding your fitness level against the competition.`;
                focus = `Focus on: To level up, add one intensity session per week‚Äîintervals or hill repeats can break through plateaus.`;
              }
            }
            
            if (lapDifference !== null) {
              if (lapDifference > 120) {
                focus += ` Your second lap was ${Math.floor(lapDifference)}s slower‚Äîwork on pacing strategy to maintain speed through the whole race.`;
              } else if (lapDifference < 30) {
                focus += ` Great lap consistency! Your even pacing is a strength to maintain.`;
              }
            }
            
            return { analysis, focus };
          };

          return (
            <>
              {/* Rider Selection */}
              <div className="bg-white rounded-lg shadow-lg p-4 md:p-6 mb-4">
                <h2 className="text-lg md:text-xl font-bold mb-3">Select a Rider</h2>
                
                <div className="relative">
                  <div className="relative">
                    <input
                      type="text"
                      placeholder="Search by rider name or team..."
                      value={searchTerm}
                      onChange={(e) => {
                        setSearchTerm(e.target.value);
                        setShowDropdown(true);
                      }}
                      onFocus={() => setShowDropdown(true)}
                      className="w-full px-4 py-3 pr-10 text-base border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                    />
                    <svg 
                      className="absolute right-3 top-3.5 w-5 h-5 text-gray-400"
                      fill="none" 
                      stroke="currentColor" 
                      viewBox="0 0 24 24"
                    >
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                  </div>

                  {showDropdown && filteredRiders.length > 0 && (
                    <div className="absolute z-20 w-full mt-1 bg-white border-2 border-gray-300 rounded-lg shadow-lg max-h-64 overflow-y-auto">
                      {filteredRiders.map(rider => (
                        <button
                          key={rider.name}
                          onClick={() => {
                            setSelectedRider(rider.name);
                            setSearchTerm('');
                            setShowDropdown(false);
                          }}
                          className={`w-full text-left px-4 py-3 hover:bg-blue-50 transition-colors border-b border-gray-100 last:border-b-0 ${
                            selectedRider === rider.name ? 'bg-blue-100' : ''
                          }`}
                        >
                          <div className="font-semibold text-gray-900">{rider.name}</div>
                          <div className="text-sm text-gray-600">{rider.team} ‚Ä¢ {rider.races} races</div>
                        </button>
                      ))}
                    </div>
                  )}

                  {showDropdown && searchTerm && filteredRiders.length === 0 && (
                    <div className="absolute z-20 w-full mt-1 bg-white border-2 border-gray-300 rounded-lg shadow-lg p-4 text-gray-500 text-center">
                      No riders found matching "{searchTerm}"
                    </div>
                  )}
                </div>

                <div className="mt-4 p-3 bg-blue-50 rounded-lg border-2 border-blue-200">
                  <div className="text-sm text-gray-600 mb-1">Currently viewing:</div>
                  <div className="font-bold text-lg text-gray-900">{selectedRider}</div>
                  <div className="text-sm text-gray-600">
                    {riderWithTeam.find(r => r.name === selectedRider)?.team} ‚Ä¢ {riderWithTeam.find(r => r.name === selectedRider)?.races} races
                  </div>
                </div>

                {showDropdown && (
                  <div 
                    className="fixed inset-0 z-10" 
                    onClick={() => setShowDropdown(false)}
                  />
                )}
              </div>

              {/* Rider Profile */}
              <div className="bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg shadow-lg p-4 md:p-6 mb-4">
                <h2 className="text-2xl md:text-3xl font-bold">{selectedRider}</h2>
                <p className="text-lg md:text-xl mt-1 md:mt-2 opacity-90">{riderTeam}</p>
                
                <div className="grid grid-cols-3 gap-3 md:gap-4 mt-4">
                  <div className="bg-white/20 backdrop-blur-sm px-3 md:px-6 py-2 md:py-3 rounded-lg">
                    <div className="text-xs md:text-sm opacity-90">Total Races</div>
                    <div className="text-xl md:text-3xl font-bold">{totalRaces}</div>
                  </div>
                  <div className="bg-white/20 backdrop-blur-sm px-3 md:px-6 py-2 md:py-3 rounded-lg">
                    <div className="text-xs md:text-sm opacity-90">Best Placement</div>
                    <div className="text-xl md:text-3xl font-bold">#{bestPlacement}</div>
                  </div>
                  <div className="bg-white/20 backdrop-blur-sm px-3 md:px-6 py-2 md:py-3 rounded-lg">
                    <div className="text-xs md:text-sm opacity-90">Podium Finishes</div>
                    <div className="text-xl md:text-3xl font-bold">{podiumCount}</div>
                  </div>
                </div>
              </div>

              {/* Race Comparison Table */}
              <div className="bg-white rounded-lg shadow-lg p-4 md:p-6 mb-4">
                <h3 className="text-xl md:text-2xl font-bold mb-4 md:mb-6">Race-by-Race Performance</h3>
                
                <div className="overflow-x-auto">
                  <table className="w-full text-sm border-collapse">
                    <thead>
                      <tr className="border-b-2 border-gray-300">
                        <th className="px-3 py-2 text-left font-semibold text-gray-700 bg-gray-50 sticky left-0 z-10"></th>
                        {riderRaces.map((race, idx) => {
                          const isPodium = parseInt(race.Placement) <= 5;
                          return (
                            <th key={idx} className={`px-3 py-2 text-left font-bold text-gray-900 min-w-[180px] ${isPodium ? 'bg-yellow-50' : ''}`}>
                              <div className="flex items-center gap-2">
                                {race.Race}
                                {isPodium && <span className="text-yellow-600">üèÜ</span>}
                              </div>
                            </th>
                          );
                        })}
                      </tr>
                    </thead>
                    <tbody>
                      <tr className="border-b bg-gray-50">
                        <td className="px-3 py-2 font-semibold text-gray-700 sticky left-0 bg-gray-50">Category</td>
                        {riderRaces.map((race, idx) => (
                          <td key={idx} className="px-3 py-2 text-gray-900">{race["Race Category"]}</td>
                        ))}
                      </tr>
                      
                      <tr className="border-b">
                        <td className="px-3 py-2 font-semibold text-gray-700 sticky left-0 bg-white">Placement</td>
                        {riderRaces.map((race, idx) => {
                          const placement = parseInt(race.Placement);
                          const isPodium = placement <= 5;
                          return (
                            <td key={idx} className="px-3 py-2">
                              <span className={`text-lg font-bold ${isPodium ? 'text-yellow-600' : 'text-gray-900'}`}>
                                #{race.Placement}
                              </span>
                            </td>
                          );
                        })}
                      </tr>
                      
                      <tr className="border-b bg-gray-50">
                        <td className="px-3 py-2 font-semibold text-gray-700 sticky left-0 bg-gray-50">Lap 1</td>
                        {riderRaces.map((race, idx) => (
                          <td key={idx} className="px-3 py-2 text-gray-900 font-mono">{race.LAP1 || '-'}</td>
                        ))}
                      </tr>
                      
                      <tr className="border-b">
                        <td className="px-3 py-2 font-semibold text-gray-700 sticky left-0 bg-white">Lap 2</td>
                        {riderRaces.map((race, idx) => (
                          <td key={idx} className="px-3 py-2 text-gray-900 font-mono">{race.LAP2 || '-'}</td>
                        ))}
                      </tr>
                      
                      <tr className="border-b bg-gray-50">
                        <td className="px-3 py-2 font-semibold text-gray-700 sticky left-0 bg-gray-50">Lap 3</td>
                        {riderRaces.map((race, idx) => (
                          <td key={idx} className="px-3 py-2 text-gray-900 font-mono">{race.LAP3 || '-'}</td>
                        ))}
                      </tr>
                      
                      <tr className="border-b">
                        <td className="px-3 py-2 font-semibold text-gray-700 sticky left-0 bg-white">Lap 4</td>
                        {riderRaces.map((race, idx) => (
                          <td key={idx} className="px-3 py-2 text-gray-900 font-mono">{race.LAP4 || '-'}</td>
                        ))}
                      </tr>
                      
                      <tr className="border-b bg-gray-50">
                        <td className="px-3 py-2 font-semibold text-gray-700 sticky left-0 bg-gray-50">Total Time</td>
                        {riderRaces.map((race, idx) => (
                          <td key={idx} className="px-3 py-2">
                            <span className="text-base font-bold text-gray-900 font-mono">
                              {formatTime(race.TotalSeconds)}
                            </span>
                          </td>
                        ))}
                      </tr>
                      
                      <tr>
                        <td className="px-3 py-3 font-semibold text-gray-700 align-top sticky left-0 bg-white">Race Analysis</td>
                        {riderRaces.map((race, idx) => {
                          const raceAnalysis = generateRaceAnalysis(race, idx, riderRaces);
                          return (
                            <td key={idx} className="px-3 py-3 text-xs bg-blue-50 align-top">
                              <p className="text-gray-800 mb-2">{raceAnalysis.analysis}</p>
                              <p className="text-gray-700">
                                <span className="font-semibold text-blue-700">üí° {raceAnalysis.focus}</span>
                              </p>
                            </td>
                          );
                        })}
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
